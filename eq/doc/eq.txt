C     $Id$
C
C     $Id$
C
      PARAMETER (NRGM=101,NZGM=101)
      PARAMETER (NPSM=101)
C
      COMMON /EQCNS1/ PI,RMU0
C
      COMMON /EQPRM1/ RR,BB,RIP
      COMMON /EQPRM2/ RA,RKAP,RDLT,RB
      COMMON /EQPRM3/ PJ0,PJ1,PJ2,PROFJ0,PROFJ1,PROFJ2
      COMMON /EQPRM4/ PP0,PP1,PP2,PROFP0,PROFP1,PROFP2
      COMMON /EQPRM5/ PROFR0,PROFR1,PROFR2,RHOITB
      COMMON /EQPRM6/ NSGMAX,NTGMAX
      COMMON /EQPRM7/ NRGMAX,NZGMAX,NPSMAX
      COMMON /EQPRM8/ EPSEQ
      COMMON /EQPRM9/ NRMAX,NTHMAX,NSUMAX
C
      COMMON /EQGLB1/ RAXIS,ZAXIS,SAXIS
      COMMON /EQGLB2/ PVOL,RAAVE,BETA,BETAP,QAXIS,QSURF
C
      COMMON /EQOUT1/ RG(NRGM),ZG(NZGM),PSIRZ(NRGM,NZGM)
      COMMON /EQOUT2/ PSIPS(NPSM),PPPS(NPSM),TTPS(NPSM)
      COMMON /EQRSP1/ URZ(4,4,NRGM,NZGM)
C
      COMMON /EQNAM1/ KNAMEQ
      CHARACTER KNAMEQ*32
C
C     $Id$
C
      PARAMETER (NSGM=32,NTGM=32)
C
      PARAMETER (MLM=NSGM*NTGM,MWM=4*NTGM-1)
      PARAMETER (NSGMP=NSGM+1,NTGMP=NTGM+1)
      PARAMETER (NSGPM=NSGM+2,NTGPM=NTGM+2)
      PARAMETER (NXM=2*NSGM)
C
      COMMON /EQMSH1/ DSG,DTG
      COMMON /EQMSH2/ SIGM(NSGM),THGM(NTGM),RHOM(NTGM)
      COMMON /EQMSH3/ RMG(NSGM,NTGMP),RGM(NSGMP,NTGM)
      COMMON /EQMSH4/ SIGG(NSGMP),THGG(NTGMP),RHOG(NTGMP)
      COMMON /EQMSH5/ RMM(NTGM,NSGM)
C
      COMMON /EQBND1/ Q(MWM,MLM)
      COMMON /EQCEF1/ AA(NSGMP,NTGM),AB(NSGMP,NTGM)
      COMMON /EQCEF2/ AC(NSGM,NTGMP),AD(NSGM,NTGMP)
C
      COMMON /EQPSI1/ PSI(NTGM,NSGM),PSI0
      COMMON /EQPSI2/ DELPSI(NTGM,NSGM)
C
      COMMON /EQRHS1/ HJT(NTGM,NSGM),PP(NTGM,NSGM),TT(NTGM,NSGM),TJ,RRC
      COMMON /EQRHS2/ HJP1(NTGM,NSGM),HJP2(NTGM,NSGM)
      COMMON /EQRHS3/ HJT1(NTGM,NSGM),HJT2(NTGM,NSGM)
C
      COMMON /EQSPL1/ NSGPMAX,NTGPMAX
      COMMON /EQSPL2/ SIGMX(NSGPM),THGMX(NTGPM)
      COMMON /EQSPL3/ PSIX(NTGPM,NSGPM)
      COMMON /EQSPL5/ U(4,4,NTGPM,NSGPM)
C
      COMMON /EQZBR1/ ZBRF
C
      COMMON /EQPRF1/ XAX(NXM),RPSI(NXM),RPP(NXM),RTT(NXM)
      COMMON /EQPRF2/ RHJP(NXM),RHJT(NXM)
C
C     $Id$
C
C     ****** DEFAULT PARAMETERS ******
C
      SUBROUTINE EQINIT
C
      INCLUDE 'eqcomm.h'
C
C
C     *** CONSTANTS ****
C
C        PI    : Pi
C        RMU0  : Permeability of free space
C
      PI=2.D0*ASIN(1.D0)
      RMU0=4.D0*PI*1.D-7
C
C     *** CONFIGURATION PARAMETERS ***
C
C        RR    : Plasma major radius                             (m)
C        RA    : Plasma minor radius                             (m)
C        RB    : Wall minor radius                               (m)
C        RKAP  : Plasma shape elongation
C        RDLT  : Plasma shape triangularity 
C        BB    : Magnetic field at center                        (T)
C        RIP   : Plasma current                                 (MA)
C
      RR     = 3.D0
      RA     = 1.D0
      RB     = RA*1.1D0
      RKAP   = 1.6D0
      RDLT   = 0.25D0
      BB     = 3.D0
      RIP    = 3.D0
C
C     *** PROFILE PARAMETERS ***
C
C        PP0   : Plasma pressure (main component)              (MPa)
C        PP1   : Plasma pressure (sub component)               (MPa)
C        PP2   : Plasma pressure (increment within ITB)        (MPa)
C        PROFP0: Pressure profile parameter
C        PROFP1: Pressure profile parameter
C        PROFP2: Pressure profile parameter
C
C        PPSI=PP0*(1.D0-(1.D0-PSIN)**PROFR0)**PROFP0
C    &       +PP1*(1.D0-(1.D0-PSIN)**PROFR1)**PROFP1
C    &       +PP2*(1.D0-((1.D0-PSIN)/(1.D0-PSIITB))**PROFR2)**PROFP2
C
C        The third term exits for RHO < RHOITB
C
      PP0    = 0.001D0
      PP1    = 0.0D0
      PP2    = 0.0D0
      PROFP0 = 1.5D0
      PROFP1 = 1.5D0
      PROFP2 = 2.0D0
C
C        PJ0   : Current density at R=RR (main component) : Fixed to 1
C        PJ1   : Current density at R=RR (sub component)       (arb)
C        PJ2   : Current density at R=RR (sub component)       (arb)
C        PROFJ0: Current density profile parameter
C        PROFJ1: Current density profile parameter
C        PROFJ2: Current density profile parameter
C
C      HJPSI=-PJ0*(1.D0-(1.D0-PSIN)**PROFR0)**PROFJ0
C     &                *(1.D0-PSIN)**(PROFR0-1.D0)
C     &      -PJ1*(1.D0-(1.D0-PSIN)**PROFR1)**PROFJ1
C     &                *(1.D0-PSIN)**(PROFR1-1.D0)
C     &      -PJ2*(1.D0-(1.D0-PSIN)**PROFR2)**PROFJ2
C     &               *(1.D0-PSIN)**(PROFR2-1.D0)
C
C        The third term exits for RHO < RHOITB
C
      PJ0    = 1.00D0
      PJ1    = 0.0D0
      PJ2    = 0.0D0
      PROFJ0 = 1.5D0
      PROFJ1 = 1.5D0
      PROFJ2 = 1.5D0
C
C        PROFR0: Profile parameter
C        PROFR1: Profile parameter
C        PROFR2: Profile parameter
C        RHOITB: Normalized radius SQRT(PSI/PSIA) at ITB
C
      PROFR0 = 1.D0
      PROFR1 = 2.D0
      PROFR2 = 2.D0
      RHOITB = 0.5D0
C
C
C     *** MESH PARAMETERS ***
C
C        NSGMAX: Number of radial mesh points for Grad-Shafranov eq.
C        NTGMAX: Number of poloidal mesh points for Grad-Shafranov eq.
C        NRGMAX: Number of horizontal mesh points in R-Z plane
C        NZGMAX: Number of vertical mesh points in R-Z plane
C        NPSMAX: Number of flux surfaces
C        NRMAX : Number of radial mesh points for flux coordinates
C        NTHMAX: Number of poloidal mesh points for flux coordinates
C        NSUMAX: Number of boundary points
C
      NSGMAX = 32
      NTGMAX = 32
C
      NRGMAX = 32
      NZGMAX = 32
      NPSMAX = 21
C
      NRMAX  = 50
      NTHMAX = 16
      NSUMAX = 41
C
C     *** CONTROL PARAMETERS ***
C
C        EPSEQ : Convergence criterion for equilibrium
C
      EPSEQ  = 1.D-6
C
C     *** FILE NAME ***
C
C        KNAMEQ: Filename of equilibrium data
C
      KNAMEQ = 'eqdata'
C
      RETURN
      END
C
C     ****** INPUT PARAMETERS ******
C
      SUBROUTINE EQPARM
C
      INCLUDE 'eqcomm.h'
C
      LOGICAL LEX
      CHARACTER KPNAME*32
C
      NAMELIST /EQ/ RR,BB,RIP,
     &              RA,RKAP,RDLT,RB,
     &              PJ0,PJ1,PJ2,PROFJ0,PROFJ1,PROFJ2,
     &              PP0,PP1,PP2,PROFP0,PROFP1,PROFP2,
     &              PROFR0,PROFR1,PROFR2,RHOITB,
     &              NSGMAX,NTGMAX,
     &              NRGMAX,NZGMAX,NPSMAX,NSUMAX,
     &              EPSEQ,
     &              NPSMAX,KNAMEQ,
     &              NRMAX,NTHMAX,NSUMAX
C
    1 WRITE(6,*) '# INPUT &eq :'
      READ(5,EQ,ERR=1,END=9000)
C
 9000 RETURN
C
C
      ENTRY EQPARF
C
      KPNAME='eqparm'
      INQUIRE(FILE=KPNAME,EXIST=LEX,ERR=9800)
      IF(LEX) THEN
         OPEN(25,FILE=KPNAME,IOSTAT=IST,STATUS='OLD',ERR=9100)
         READ(25,EQ,ERR=9800,END=9900)
         CLOSE(25)
         WRITE(6,*) '## FILE (',KPNAME,') IS ASSIGNED FOR PARM INPUT'
      ENDIF
      GOTO 9000
C
 9100 WRITE(6,*) 'XX PARM FILE OPEN ERROR : IOSTAT = ',IST
      RETURN
 9800 WRITE(6,*) 'XX PARM FILE READ ERROR'
      RETURN
 9900 WRITE(6,*) 'XX PARM FILE EOF ERROR'
      END
C
C     ****** SHOW PARAMETERS ******
C
      SUBROUTINE EQVIEW
C
      INCLUDE 'eqcomm.h'
C
      WRITE(6,601) 'RR    ',RR,
     &             'BB    ',BB,
     &             'RIP   ',RIP,
     &             'EPSEQ ',EPSEQ
      WRITE(6,601) 'RA    ',RA,
     &             'RKAP  ',RKAP,
     &             'RDLT  ',RDLT,
     &             'RB    ',RB
      WRITE(6,601) 'PP0   ',PP0,
     &             'PROFP0',PROFP0,
     &             'PJ0   ',PJ0,
     &             'PROFJ0',PROFJ0
      WRITE(6,601) 'PP1   ',PP1,
     &             'PROFP1',PROFP1,
     &             'PJ1   ',PJ1,
     &             'PROFJ1',PROFJ1
      WRITE(6,601) 'PP2   ',PP2,
     &             'PROFP2',PROFP2,
     &             'PJ2   ',PJ2,
     &             'PROFJ2',PROFJ2
      WRITE(6,601) 'PROFR0',PROFR0,
     &             'PROFR1',PROFR1,
     &             'PROFR2',PROFR2,
     &             'RHOITB',RHOITB
      WRITE(6,602) 'NSGMAX ',NSGMAX,
     &             'NTGMAX',NTGMAX,
     &             'NRGMAX',NRGMAX,
     &             'NZGMAX',NZGMAX
      WRITE(6,602) 'NRMAX ',NRMAX,
     &             'NTHMAX',NTHMAX,
     &             'NPSMAX',NPSMAX,
     &             'NSUMAX',NSUMAX
C
      RETURN
  601 FORMAT(4(A6,'=',1PE11.2:2X))
  602 FORMAT(4(A6,'=',I7:6X))
      END
