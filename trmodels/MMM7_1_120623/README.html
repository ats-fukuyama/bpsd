<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta content="text/html; charset=ISO-8859-1"
 http-equiv="Content-Type">
  <title>README: MMM</title>
  <meta content="Lixiang Luo" name="author">
</head>
<body>
<h1 style="text-align: left;">MMM7.1 Transport Model</h1>
Prepared by<br>
<br>
Lixiang Luo (<a href="mailto:lixiang.luo@lehigh.edu"><span
 style="font-family: monospace;">lixiang.luo@lehigh.edu</span></a>)<br>
Tariq Rafiq (<a href="mailto:tar207@lehigh.edu"><span
 style="font-family: monospace;">rafiq@lehigh.edu</span></a>)<br>
Arnold Kritz (<a href="mailto:kritz@lehigh.edu"><span
 style="font-family: monospace;">kritz@lehigh.edu</span></a>)<br>
<h2>REVISION HISTORY</h2>
<table style="text-align: left; width: 100%;" border="1" cellpadding="2"
 cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top; font-weight: bold;">Date </td>
      <td style="vertical-align: top; font-weight: bold;">Description</td>
    </tr>
    <tr>
      <td style="vertical-align: top;">11-May-2011<br>
      </td>
      <td style="vertical-align: top;">Documentation updated<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">11-Feb-2010</td>
      <td style="vertical-align: top;">Release - Version 7.1.0</td>
    </tr>
  </tbody>
</table>
<br>
<h2>INTRODUCTION</h2>
This software package contains the multi-mode anomalous transport
module version 7.1 (MMM7.1). MMM7.1 is a theory-based transport model
which has been used to predict temperature, density and toroidal
rotation profiles for tokamak plasmas. The model includes an improved
Weiland model for the ITG, TEM, and MHD modes, the Horton model for
short wavelength ETG model and a new model for the drift resistive
inertial ballooning modes (DRIBM). The ETG transport threshold in the
Horton model is refined by using threshold obtained from toroidal
gyrokinetic ETG turbulence. These components of transport models
provide contributions to transport in the different regions of plasma
discharge.&nbsp; The complete documentation (doc/mmm_ref.pdf) of MMM7.1
package can be found in the "doc" subdirectory.<br>
<br>
NOTE: MMM7.1 module has been tested and used only with double
precision.<br>
<br>
<h2>PREREQUISITES</h2>
<p>MMM7.1 is intended to be built on an x86 POSIX-complaint OS
(UNIX, Linux, Cygwin, etc.) with a Fortran 90 compiler. The rest of
README will assume that you are running an x86 Linux system with a BASH
shell. "make" and "ar" must be installed in the OS.
Building on Cygwin is supported, although the compiler options are much
more limited. Building on other architectures may be possible but not
yet tested. Users and developers are welcome to send in their
experience on building MMM7.1 on different architectures.<br>
<br>
</p>
<h2>CONTENTS</h2>
First, unpack the source using this command on any POSIX-compliant
operating system:
<pre style="margin-left: 40px;">$ tar xvzf mmm-7.1.tar.gz</pre>
Future MMM releases will have version numbers in the X.x form, where X
is the major release number and lowercase x is the minor release
number. The
release numbers are used as a suffix, in the form of X_x, for naming
some source files and directories.<br>
<p>Upon unpacking, you will be able to see the following files,
organized
in a cascade structure:</p>
<span style="font-family: monospace;"></span>
<pre>     mmm7_1/<br>        | Makefile<br>        | README and README.html<br>        |<br>        +- doc/<br>        |   | mmm_ref.pdf<br>       &nbsp;|<br>        +- libmmm7_1/<br>        |   | Makefile<br>        |   | modmmm7_1.f90<br>        |   | w20_README.txt<br>        |   | w20mod.f90<br>        |<br>        +- testmmm/<br>            | Makefile<br>            | testmmm.f90<br>            |<br>            +- case-lmode/<br>            |   | sample_input<br>            |   | sample_output <br>            |<br>            +- case-hmode/<br>            |   | sample_input<br>            |   | sample_output<br>            |<br>            +- case-2ndkind/<br>                | sample_input<br>                | sample_output<br><br></pre>
<p>These files are as follows:</p>
<h3>Main directory</h3>
<table style="text-align: left; width: 100%;" border="1" cellpadding="2"
 cellspacing="2">
  <tbody>
    <tr>
      <td style="width: 20%; font-family: monospace;">Makefile</td>
      <td style="vertical-align: top;">The master makefile, intended
for building the whole MMM7.1 package. This makefile is designed to
accept
any compiler command. See "COMPILATION INSTRUCTIONS" section for more
details.</td>
    </tr>
    <tr>
      <td style="font-family: monospace;">README.html<br>
README<br>
      </td>
      <td style="vertical-align: top;">This file. Brief descriptions of
the other files, and instructions for
compiling the module containing the MMM7.1 transport model and a driver
program.<br>
      </td>
    </tr>
  </tbody>
</table>
<h3>doc sub-directory</h3>
<table style="text-align: left; width: 100%;" border="1" cellpadding="2"
 cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top; width: 20%;"><span
 style="font-family: monospace;">mmm_ref.pdf</span><br>
      </td>
      <td style="vertical-align: top;">Documentation for MMM7.1 in PDF
format.<br>
      </td>
    </tr>
  </tbody>
</table>
<h3>libmmm7_1 sub-directory</h3>
<table style="text-align: left; width: 100%;" border="1" cellpadding="2"
 cellspacing="2">
  <tbody>
    <tr>
      <td style="width: 20%; font-family: monospace;">Makefile</td>
      <td style="vertical-align: top;">Secondary makefile for
libmmm7_1,
intended for building the module only.</td>
    </tr>
    <tr>
      <td style="font-family: monospace;">modmmm7_1.f90</td>
      <td style="vertical-align: top;"> F90 source file containing the
mmm7_1 subroutine and documentation. Plasma transport coefficients
obtained using the Multi-Mode transport model, are computed.
Contributions to transport from the Weiland, DRIBM and ETG models are
computed in this routine.</td>
    </tr>
    <tr>
      <td style="font-family: monospace;">w20mod.f90<br>
      </td>
      <td style="vertical-align: top;">Original source of the Weiland20
module, packaged as one single Fortran 90 module.<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><span
 style="font-family: monospace;">w20_README.txt</span><br>
      </td>
      <td style="vertical-align: top;">Original documentation of the
Weiland20 module.<br>
      </td>
    </tr>
  </tbody>
</table>
<h3>testmmm subdirectory</h3>
<table style="text-align: left; width: 100%;" border="1" cellpadding="2"
 cellspacing="2">
  <tbody>
    <tr>
      <td style="font-family: monospace;">Makefile</td>
      <td style="vertical-align: top;">Secondary makefile for the
"testmmm" driver program.</td>
    </tr>
    <tr>
      <td style="width: 20%; font-family: monospace;">testmmm.f90</td>
      <td style="vertical-align: top;">F90 source file of the driver
program. The program reads the
input file "input" and writes the output file, "output". Contributions
of each of the modes to the thermal and particle diffusivities are
written to the file "output". Two kinds of input data can be accepted.
The first kind contains values for all profiles, and the second kind
contains shape function parameters for constructing simple polynomial
profiles.<br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;">case-lmode/sample_input</td>
      <td style="vertical-align: top;">Sample input file for a D3D-like
L-mode
case.<br>
      </td>
    </tr>
    <tr>
      <td style="font-family: monospace;">case-lmode/sample_output</td>
      <td style="vertical-align: top;">Sample output file for a
D3D-like L-mode case. </td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">case-hmode/sample_input</td>
      <td style="vertical-align: top;">Sample input file for a D3D-like
H-mode
case.</td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">case-hmode/sample_output</td>
      <td style="vertical-align: top;">Sample output file for a
D3D-like H-mode case.</td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">case-2ndkind/sample_input</td>
      <td style="vertical-align: top;">Sample input file for an L-mode
case
generated using second kind of input<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">case-2ndkind/sample_output</td>
      <td style="vertical-align: top;">Sample output file for an L-mode
case generated using second kind of input</td>
    </tr>
  </tbody>
</table>
<br>
<h2>COMPILATION INSTRUCTIONS</h2>
<p>Follow the two-step procedure to build the binaries:</p>
<ol>
  <li>Set the environmental variable "MMMFC" to the compiler
command
on your system. Here are some common examples:</li>
  <table style="text-align: left; width: 100%;" border="1"
 cellpadding="2" cellspacing="2">
    <tbody>
      <tr>
        <td
 style="vertical-align: top; text-align: center; font-weight: bold;">If
you are using ...</td>
        <td
 style="vertical-align: top; text-align: center; font-weight: bold;">MMMFC
should
be
set
to
...</td>
      </tr>
      <tr>
        <td style="vertical-align: top; text-align: center;">G95</td>
        <td
 style="vertical-align: top; text-align: center; font-family: monospace;">g95<br>
        </td>
      </tr>
      <tr>
        <td style="vertical-align: top; text-align: center;">GNU Fortran<br>
        </td>
        <td
 style="vertical-align: top; text-align: center; font-family: monospace;">gfortran</td>
      </tr>
      <tr>
        <td style="vertical-align: top; text-align: center;">Intel
Fortran</td>
        <td
 style="vertical-align: top; text-align: center; font-family: monospace;">ifort<br>
        </td>
      </tr>
      <tr>
        <td style="vertical-align: top; text-align: center;">PathScale
Fortran</td>
        <td
 style="vertical-align: top; text-align: center; font-family: monospace;">pathf95<br>
        </td>
      </tr>
    </tbody>
  </table>
  <br>
Use "export" on Bourne-style shells and "setenv" on
C-style shells
to set environment variables. For example, on BASH:
  <ol>
    <pre>$ export MMMFC=pathf95</pre>
  </ol>
or on TCSH:
  <ol>
    <pre>% setenv MMMFC pathf95</pre>
  </ol>
Note that if you do not set any value for MMMFC, it will default to
gfortran.<br>
  <br>
  <li>To compile the whole package, including the Fortran module
modmmm7_1 and the
stand-alone driver program "testmmm"
simply
run:<br>
    <pre style="margin-left: 40px;">$ make</pre>
inside the main directory to invoke the master makefile, which will
then invoke secondary
makefiles to build the module and the
driver program. The binary files (*.o, *.a and testmmm) are placed
alongside with their
source codes. To delete all binary files, use:<br>
    <pre style="margin-left: 40px;">$ make clean</pre>
You can generate debugging-ready binary files using these commands:<br>
    <pre style="margin-left: 40px;">$ make clean<br>$ make debug</pre>
  </li>
</ol>
<p>It is possible to build the module and the driver program
separately,
using only the secondary makefiles. In this case, follow these steps:</p>
<ol>
  <li>Set the environmental variable "MMMFC" to the compiler
command on your system.</li>
  <li>Change the current directory to the subdirectory where you want
to
build binaries and issue the "make" command.</li>
</ol>
<p>Note that the driver program depends on the module. Any change to
the
module source codes requires a re-compilation of the module before the
driver program should be build. This
procedure is automatic when the master makefile is used. However, when
using secondary makefiles this has to be done manually.<br>
<br>
</p>
<h2>TESTING INSTRUCTIONS</h2>
<p>The driver program "testmmm" requires only one input file called
"input". Since the input file is a Fortran namelist file, the variables
can be arranged in any order.<br>
<br>
</p>
<p>To produce the test cases:</p>
<ol>
  <li>Change the current directory to the subdirectory of one of the
test cases, such as <span style="font-family: monospace;">case-lmode</span></li>
  <li>Copy the sample input file, "sample_input", to "input":
    <pre style="margin-left: 40px;">$ cp sample_input input</pre>
  </li>
  <li>Run the driver program by<br>
    <pre style="margin-left: 40px;">$ ../testmmm<br></pre>
Note that the driver program is located in the parent
directory.</li>
</ol>
<p>As it runs, "testmmm" will generate an output file "output". The
output file contains a listing of all possible input arguments for
subroutine mmm7_1 and it is followed by a listing of all possible
output
arguments of the subroutine. You can
then do a
simple comparison between the output you obtained and the given sample
output, using the
"diff" command:
</p>
<pre style="margin-left: 40px;">$ diff output sample_output</pre>
<p>which should give little to no output, if the driver program is
correctly built. Further information on <span
 style="font-family: monospace;">testmmm </span>can be found in the
documentation (doc/mmm_ref.pdf).</p>
<p>Output is given as a simple text spreadsheet, which can be
interpreted easily by plotting tools such as gnuplot. For example, the
output of case-lmode case be visualized using gnuplot by these commands
run in the <span style="font-family: monospace;">case-lmode</span>
subdirectory:<br>
</p>
<pre style="margin-left: 40px;">$ gnuplot<br>gnuplot&gt; plot '&lt; tail -n 51 output' u 1:4 w l ti 'theig'<br></pre>
<p>Note that <span style="font-family: monospace;">case-lmode</span>
has 51 zones (radial points). This gnuplot command extracts the last 51
lines of the
output file and generates an X-Y plot with the minor radius (column 1)
on X axis and the electron thermal diffusivity <span
 style="font-family: monospace;">theig</span> (column 4) on the Y axis.<br>
<br>
</p>
<h2><span style="font-weight: bold;"></span>LINKING INSTRUCTIONS</h2>
<p>To use MMM7.1 in your own program, the following issues need to be
taken
care of:</p>
<ol>
  <li>The "USE" statement in your Fortran program</li>
  <li>A proper "CALL" statement of the mmm7_1 subroutine</li>
  <li>Linking of libmmm7_1.a against other binary object files<br>
  </li>
</ol>
<p>Note that the current version of MMM7.1 uses optional arguments
extensively, thus requiring the use of explicit interface. If any
optional argument is omitted, argument association by keywords must be
used. Even in the case where no optional argument is omitted, the use
of argument
keywords is still strongly recommended, considering the large amount of
arguments involved. An example of this style of
subroutine call is given in the source file of the driver program,
"testmmm.f90". One clear
advantage of argument keywords is that the compiler can always
determine the correct argument association, regardless of the order and
the choices of
actual arguments.</p>
<p>All array dummy arguments are defined as assumed-shape arrays, in
contrast to earlier versions of MMM, which used deferred-shape arrays.
Several arguments are optional. Please refer to the module source
(modmmm7_1.f90) for
more details on the selection of optional arguments.</p>
<p>A successful build of the MMM module will generate a number of
binary
files, among them are the two most important, "libmmm7_1.a" and
"modmmm7_1.mod"
("modmmm7_1.MOD" if PathScale compilers are used) in the "libmmm7_1"
subdirectory. "libmmm7_1.a" is the static-link library and
"modmmm7_1.mod"
is the FORTRAN module file.<br>
</p>
<p>The compilation of any source file that use the modmmm module
requires the compiler to correctly locate the module file
("modmmm7_1.mod"). Most compiler search "*.mod"
files
in directories listed after the -I option. Module files are generally
incompatible among different compilers. You will not be able to compile
the driver program with compiler
B if the
MMM7.1 module is compiled using compiler A.</p>
<p>Linking of "libmmm7_1.a" against other binary object files should
only
involve
putting libmmm7_1.a in the object file list, as long as the file can be
located by the compiler. Note that only static linking is supported in
this version. Please follow the instructions of your Fortran compiler
to set appropriate options.</p>
<h3>The manual compilation commands</h3>
<p>If the make utility does not work, or if the module is being
compiled on an unsupported platform then the compilations may need to
be done by hand. What follows are step-by-step instructions for
creating the test executable "testmmm".<br>
</p>
<ol>
  <li>Compile and produce the static-link library from the module
source files. Suppose the Fortran 90
compiler on your system is called "f90". An object code is produced
when
the compiler is invoked with a "-c" option. Starting from main
directory:<br>
    <pre style="margin-left: 40px;">$ cd libmmm7_1<br>$ f90 -c w20mod.f90 -o w20mod.o<br>$ f90 -c modmmm7_1.f90 -o modmmm7_1.o<br>$ ar rcs libmmm7_1.a w20mod.o modmmm7_1.o<br>$ cd ..<br></pre>
Note that "w20mod.f90" must be compiled first because it is the source
file of a Fortran 90 module used by other MMM source files.<br>
  </li>
  <li>Compile the driver program and link the object codes
together, producing the executable "testmmm":<br>
    <pre style="margin-left: 40px;">$ cd testmmm<br>$ f90 -c -I../libmmm7_1 testmmm.f90 -o testmmm.o<br>$ f90 testmmm.o ../libmmm7_1/libmmm7_1.a -o testmmm<br></pre>
  </li>
</ol>
<p>Please note that how the module file ("modmmm7_1.mod") is located by
the -I option and how the static-link library ("libmmm7_1.a") is linked
with other object files. To generate debugging-ready binary files,
replace all "-c" with "-g -c".<br>
<br>
</p>
<h2>COMPILER-WISE NOTES</h2>
<h3>g95</h3>
<p>Earlier versions of g95 may have problems with data types. Please
use the
latest stable version (&gt;0.93).<br>
</p>
<h3>PathScale (as for v3.2)</h3>
<p>The driver program generated by this compiler cannot process
namelist input
files with Windows/DOS-style newline. A typical error message when
running "testmmm" would look like this:</p>
<pre style="margin-left: 40px;">lib-4324 : UNRECOVERABLE library error<br><br>' is unrecognized in namelist input.<br>Encountered during a namelist READ from unit ...</pre>
<p>A tool called "dos2unix" (included in Cygwin and most Linux
distributions) can be used to convert these input files.<br>
<br>
</p>
<h2>CONTACTS</h2>
<p>If you have any problems, please contact<br>
</p>
<div style="margin-left: 40px;"><span style="font-weight: bold;">Lixiang
Luo</span><br>
Department of Physics, Lehigh University<br>
<span style="font-family: monospace;">lixiang.luo@lehigh.edu</span><br>
</div>
<br>
<div style="margin-left: 40px;"><span style="font-weight: bold;">Arnold
H. Kritz</span><br>
Department of Physics, Lehigh University<br>
<span style="font-family: monospace;">kritz@lehigh.edu</span><br>
</div>
</body>
</html>
