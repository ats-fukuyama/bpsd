<!-- This file was generated by W.A. Houlberg -->
<HTML>

<HEAD>
  <TITLE>
    NCLASS_PT Info
  </TITLE>
  <STYLE>
    BODY {BACKGROUND: silver;
          FONT-FAMILY: Arial, sans-serif;
          FONT-SIZE: 10pt;
          COLOR: black}
    CODE {FONT-FAMILY: typewriter;
          FONT-WEIGHT: bold}
    STRONG {FONT-FAMILY: symbol, fantasy;
            FONT-WEIGHT: bold}
    PRE {FONT-FAMILY: typewriter;
         FONT-WEIGHT: bold}
    H1 {FONT-FAMILY: Arial Black, sans-serif;
        FONT-SIZE: 18pt;
        COLOR: darkred}
    H2 {FONT-SIZE: 18pt;
        FONT-WEIGHT: bold;
        COLOR: red}
    H3 {FONT-SIZE: 14pt; 
        FONT-WEIGHT: bold;
        COLOR: blue}
    H4 {FONT-SIZE: 12pt; 
        FONT-WEIGHT: bold;
        COLOR: black}
  </STYLE>
</HEAD>

<BODY>
  <CENTER>
    <H1>Documentation</H1>
  </CENTER>
  <H2><A NAME="Introduction">Introduction</A></H2>
        The NCLASS module calculates the neoclassical transport
        properties of a multi-species axisymmetric plasma of arbitrary
        aspect ratio, geometry and collisionality.  It is designed to be
        called from a transport code that provides the plasma density
        and temperature profiles as well as a number of flux surface
        averaged geometric quantities.
      <P>
        The NCLASS_PT stand-alone driver supplied with the NCLASS module
        provides sample input for a	single call to NCLASS (a single flux
        surface).  It uses a simplified large aspect ratio elongated plasma
        approximation to generate the required geometric input.  It then
        gives examples of reconstructing the fluxes, bootstrap current,
        and rotation velocities from the NCLASS module output and writes
        a summary of the results of the test case.  If the user is
        interested in incorporating NCLASS as a module in another code,
        the driverroutine provides valuable examples of how to manipulate
        the output to generate other related quantities.
      <P>
        For inclusion of the NCLASS module in a transport or other
        analysis code, there are additional modules available from
        the author for reading VMEC or EFIT output files, and others for
        calculating the required flux surface averaged geometric
        quantities from either of those representations.
      <P>
        Significant effort has gone into making the NCLASS module
        computationally efficient so it can be used for routine analysis
        in transport codes.  It has been incorporated into several
        transport codes (e.g., TRANSP, ONETWO, ASTRA) and also used
        extensively in another stand-alone form (FORCEBAL code) for
        analysis of data (e.g., at PPPL, GA, JET, TEXTOR, Tore Supra).
        Although the numerical procedures are rather sophisticated, it
        is computationally robust.
      <P>
        All units are in mks with temperatures in keV.  The radial
        variable can be in any unit of the user's choice as long as all
        input to NCLASS is consistent (see 
        <A HREF="#Radial grid">Radial grid</A>).  There is
        no way to check this consistency inside NCLASS.  Many of the
        output quantities also carry the arbitrary unit of the radial
        variable (see <A HREF="#NCLASS Variables">NCLASS Variables</A>
        or the comment blocks at the beginning of each routine).
      <P>
        File names and routines are rendered as bold uppercase in a
        typewriter font: <CODE>FILENAME.EXT</CODE>
      <P>
        Coding and variable names are rendered as bold lowercase in a typewriter
        font: <CODE>p_ft</CODE>
      <P>
        Greek characters appear as (if the Symbol font is available these
        are greek letters): <STRONG>abcd</STRONG> 
    <H3><A NAME="Help files">Help files</A></H3>
        The Help files describing the various features are accessed
        through the multiple frame HTML file
        <CODE>README_NCLASS_PT.HTML</CODE>:
      <PRE>
          README_NCLASS_PT.HTML
          |
          |--NCLASS_PT_TOP.HTML
          |
          |--NCLASS_PT_INFO.HTML
          |
          |--NCLASS_PT_INDEX.HTML
             |
             |--COMPUTER.GIF
             |
             |--COUNTER.GIF
      </PRE>
        The GIF files have been added for entertainment, courtesy of my
        daughter, Michele, who convinced me HTML was a snap to learn. 
        In fact, it is almost as easy as LaTeX.        
    <H3><A NAME="FORTRAN sources">FORTRAN sources</A></H3>
        The FORTRAN sources consist of the NCLASS module,
        <PRE>
          NCLASS_MOD.FOR
        </PRE>
        the driver,
        <PRE>
          NCLASS_PT_DR.FOR
        </PRE>
        three PARAMETER 'include' files,
        <PRE>
          PAMX_MI.INC
          PAMX_MS.INC
          PAMX_MZ.INC
        </PRE>
        a few auxiliary function routines,
        <PRE>
          U_ERF.FOR
          U_LU_BACKSUB.FOR
          U_LU_DECOMP.FOR
        </PRE>
        array manipulation routines,
        <PRE>
          RARRAY_COPY.FOR
          RARRAY_SUM.FOR
          RARRAY_ZERO.FOR
        </PRE>
        and a module that control the 'write' formats,
        <PRE>
          WRITE_MOD.FOR
        </PRE>
        Each routine has a description block at the beginning that
        covers functionality, and all I/O.  A flow and dependency
        diagram for NCLASS_PT is shown under
        <A HREF="#Flow Diagram">Flow Diagram</A>
        <P>
        The parameters have been set up to handle a maximum of nine
        isotopes at a time, a maximum of forty species (populated charge
        states of all isotopes) and Z up to 18.  Although this is more
        than adequate for most problems, NCLASS has been applied to
        problems that exceed each of these limits.  A diagnostic error
        is generated by NCLASS if the problem calls for exceeding any of
        these limits.        
    <H3><A NAME="Makefile">Makefile</A></H3>
        A UNIX 'makefile' is included, but it has only had limited
        testing:
        <PRE>
          MAKEFILE
        </PRE>
    <H3><A NAME="NAMELIST input">NAMELIST input</A></H3>
        All input to NCLASS_PT is provided via a NAMELIST in the file:
        <PRE>
          IN_NCLASS_PT.NML
        </PRE>
        All input variables are set to the test case values as defaults
        in the driver.  Below is a description of the NAMELIST
        variables, and whether they are used directly for input to
        NCLASS (see	<A HREF="#NCLASS input">NCLASS input</A>) or used by
        the driver routine (see <A HREF="#Driver input">Driver input</A>)
        to generate other required NCLASS input, control the output, etc.
      <H4>Local to driver</H4>
        <PRE>
          k_out-option for output to nout (-)
               =1 errors only
               =2 errors and results 
               =else no output
          p_eps-inverse aspect ratio (-)
          p_q-safety factor (-)
          r0-major radius (m)
          a0-minor radius, scale length for rho (m)
          e0-axial elongation (-)
          bt0-axial toroidal field (T)
          q0-axial safety factor (-)
        </PRE>
      <H4>Passed to NCLASS</H4>
        <PRE>
          k_order-order of v moments to be solved (-)
                 =2 u and q									
                 =3 u, q, and u2
                 =else error
          k_potato-option to include potato orbits (-)
                  =0 off
                  =else on
          c_den-density cutoff below which species is ignored (/m<SUP>3</SUP>)
          p_grphi-radial electric field Phi' (V/rho)
          p_gr2phi-radial electric field gradient Psi'(Phi'/Psi')' (V/rho<SUP>2</SUP>)
          amu_i(i)-atomic mass number of i (-)
          temp_i(i)-temperature of i (keV)
          den_iz(i,z)-density of i,z (/m<SUP>3</SUP>)
        </PRE>
        The <CODE>p_*</CODE> values are for the	flux surface of
        interest, i.e., radial variables when NCLASS is	called in a loop
        over radial nodes.  (For a discussion of naming conventions, see
        <A HREF="#Name Conventions">Name Conventions</A>). The <CODE>*0</CODE>
        values are global or axial values to generate the potato orbit
        parameters and other approximate geometric quantities. 
        <CODE>a0</CODE> is used to generate	characteristic gradient
        scales. <CODE>Phi</CODE> denotes the electric potential.  The radial
        electric field and its derivative are expressed in terms of the
        electric potential because NCLASS uses flux surface averaged
        quantities in its equations.  <CODE>Psi</CODE> is the poloidal
        flux contained within the flux surface of interest (not divided
        by 2<STRONG>p</STRONG>).
        <P>
        NCLASS_PT sets up the gradients and metrics using a radial
        grid, <STRONG>r</STRONG>, that is proportional to the square root
        of the toroidal flux and normalized to <CODE>a0</CODE> so that it
        has units of meters, and <CODE>'</CODE>designates derivatives with
        respect to <STRONG>r</STRONG>.
    <H3><A NAME="NCLASS_PT cases">NCLASS_PT cases</A></H3>
        Generally, NCLASS has been run with electrons as the first isotope,
        although that is arbitrary.  Because of the possibility that the
        thermal species are not in charge balance (e.g., with neutral
        beam injection, a tail population of ions from RF heating,
        runaway electrons, etc.), NCLASS does not impose charge
        neutrality.  However, ambipolarity should be a consequence of the
        properties of the collision operator.  The viscosity or its
        individual components can also be turned off by modifiying the
        driver.  This flexibility allows the user to test various limits
        against other models.
      <H4>Multiple charge state default case</H4>
        The sample NAMELIST solves for six species (e, H, C<SUP>+2</SUP>,
        C<SUP>+4</SUP>, O<SUP>+5</SUP>, and O<SUP>+7</SUP>), representing
        four isotopes (e, H, C, and O) to illustrate the multiple charge
        state treatment.  The specification of isotopes is governed by
        the	<CODE>amu_i</CODE> and <CODE>temp_i</CODE> input, and the
        isotopic populations by <CODE>den_iz</CODE>.
      <H4>Ion-ion problem</H4>
        NCLASS can be run without electrons (negative charge is assigned
        to species with	<CODE>amu_i</CODE> &lt; 0.5) to calculate the
        transport resulting from ion-impurity collisions only.  The
        resulting fluxes should be ambipolar.  This case can be run by
        modifying the input in the <CODE>IN_NCLASS_PT.NML</CODE> file.
      <H4>Two temperature distribution</H4> 
        NCLASS can accept a two temperature distribution by specifying
        two isotopes with the same mass and charge (e.g.,
        <CODE>amu_i(2)</CODE> = <CODE>amu_i(3)</CODE> = 2.0 with
        different temperatures and densities for isotopes 2 and 3
        governed by <CODE>den_iz</CODE> and <CODE>temp_i</CODE> input).
        This case can be run by	modifying the input in the
        <CODE>IN_NCLASS_PT.NML</CODE> file.
      <H4>Axial bootstrap current/potato orbits</H4>
        Potato orbit effects can be turned on with the switch
        <CODE>k_potato</CODE> = 1.  This provides an empirical
        modification of the viscosity near the magnetic axis to match
        theoretical limits.  With large potato orbit corrections, the
        trapped fraction does not vanish at the axis.  Although the
        potato orbit results have appeared reasonable in various tests
        and applications to TFTR, DIII-D and ITER the viscosity has not
        been benchmarked against more detailed kinetic calculations to
        verify either the radial extent of the orbit corrections or the
        form.
    <H3><A NAME="Beyond NCLASS_PT">Beyond NCLASS_PT</A></H3>
        These cases are within the realm of NCLASS capabilities, but the
        NCLASS_PT driver would have to be modified to accomodate them.
      <H4>Banana-only viscosity</H4>
        The Pfirsch-Schl&uuml;ter contribution to viscosity can be turned
        of by setting all poloidal elements of the geometric factor
        <CODE>p_fm</CODE> to zero.
      <H4>Pfirsch-Schl&uuml;ter-only viscosity</H4>
        The banana regime contributon to the viscosity can be turned off
        by setting the trapped particle fraction (<CODE>p_ft</CODE>) to
        zero.
      <H4>Spitzer problem (no viscosity)</H4>
        The Spitzer problem is solved by setting both <CODE>p_fm</CODE>
        and <CODE>p_ft</CODE> to zero.
      <H4>Removing axial singluarity</H4>
        Choose <STRONG>r</STRONG> (see <A HREF="#Radial grid">
        Radial grid</A>) proportional to the poloidal flux,
        <STRONG>Y</STRONG> to remove an axial singularity in
        <CODE>p_fhat</CODE>.  (d<STRONG>Y</STRONG>/d<STRONG>r</STRONG>
        enters through the denominator of the NCLASS input variable
        <CODE>p_fhat</CODE>).  For other grid representations (e.g.,
        where <STRONG>r</STRONG> is proportional to the square root of
        the toroidal flux as in NCLASS_PT), avoid calling NCLASS at
        the origin where the variable <CODE>p_fhat</CODE> is singular.
        The simple geometry	and choice of grid in NCLASS_PT do not
        allow the user to calculate axial modifications without
        revising the driver.
      <H4>Other cases</H4>
        <i>If you wish to apply NCLASS to unusual cases, or if you
        obtain a strange result from one of the above cases, consult
        the author.</i>  Although NCLASS has undergone extensive
        testing, not all possible cases have been explored.
    <H3><A NAME="NCLASS_PT output">NCLASS_PT output</A></H3>
        A single output file is generated by the driver:
        <PRE>
          OUT_NCLASS_PT.DAT
        </PRE>
        If <CODE>k_out</CODE> = 1 is selected, the only output will be
        warnings and error messages.  For <CODE>k_out</CODE> = 2,
        warnings and error messages plus results will be output.  Other
        choices of <CODE>k_out</CODE> eliminate all output. 
    <H3><A NAME="Precision">Precision</A></H3>
        NCLASS runs in single precision on 32-bit machines and yields at
        least four digit accuracy, which is several orders of magnitude
        more accurate than the physics representation.
    <H3><A NAME="Known problems">Known problems</A></H3>
        NCLASS in its various forms has been run on dozens of platforms.
        NCLASS_PT may have two I/O difficulties that are easy to
        correct.  NAMELIST input formats are not standard and neither
        are OPEN statements in FORTRAN 77.  In that regard NCLASS_PT uses
        the FORTRAN 90 standard.  Otherwise, NCLASS and NCLASS_PT are
        essentially written in FORTRAN 77 except for a few items of
        style that all FORTRAN 77 compilers (that the author has used)
        have adopted.  Symptoms of the NAMELIST problem are an inability
        to read the input because of the beginning and ending symbols.  
        Errors in the OPEN statement can occur on some platforms when
        generating the output file if an output file already exists. 
        The forms used for the NAMELIST file and OPEN statements have
        worked with all FORTRAN 90 compilers the author has used.           
  <H2><A NAME="Revisions">Revisions</A></H2>
    <H3><A NAME="NCLASS_PT 1.1">NCLASS_PT 1.1</A></H3>
        Extensive revisions have been made to this version of NCLASS and
        its 'single spatial point' driver NCLASS_PT to:
        <UL>
        <LI>Expand the physics
        <LI>Simplify the interface to NCLASS for incorporation into a
            transport code
        <LI>Increase computational efficiency
        <LI>Conform to standards and goals of the NTCC project
        </UL>
      <H4>Extended physics</H4>
        Potato orbit effects are included as an option through the
        switch <CODE>k_potato</CODE>.
        <P>
        The parallel current response to the external force has been
        added.  An example of the use of this feature is that it
        gives the response current to neutral beam current drive when
        the beam parallel forces are input through <CODE>fex_iz</CODE>.
      <H4>Simplified interface</H4>
        The sequential calls to five NCLASS routines have been wrapped
        into a single interface routine in the NCLASS module.  The
        interface calculates dependent variables and hides many of the
        internal variables.
        <P>
        The calculations of one of the internal routines that had
        minimal functionality have been absorbed by the interface
        routine.
        <P>
        All I/O for the NCLASS module is now passed as arguments
        through the interface routine.  This facilitated the removal
        of all COMMON blocks.
      <H4>Efficiency</H4>
        Although earlier versions of NCLASS allowed the user to specify
        the order of the viscosity and friction matrices (i.e., use of
        either 2 or 3 velocity moments) the full 3x3 matrices of
        friction and viscosity coeffcients were being calculated.  Now
        the matrices are calculated as 2x2 when the option
        <CODE>k_order</CODE> = 2 is specified,
        reducing the computational time by nearly a factor of two.  For
        most applications only two moments are necessary.  In
        collisional plasmas (Pfirsch-Schl&uuml;ter regime) it can be
        important to include the third moment terms.  Not all the
        important third moment terms have been implemented in NCLASS
        (see closure discussion in the Hirshman and Sigmar review, it's
        messy).  The retention of the third	order terms is to accomodate
        further development, primarily for edge plasmas.           
        <P>
        Some of the internal variables have been redefined as 'species'
        arrays to reduce the checking for significantly	 populated
        states.  The mapping from (mass, charge state) to populated
        species is done in the interface, used extensively internally,
        and then passed out to help the user interpret the results.
        Because the (mass,charge state) arrays are typically very sparse
        (usually only a single charge state is used for each isotope)
        this eliminates a lot of unnecessary storage, time consumption
        in passing arrays through arguments, and zeroing out large
        arrays.
      <H4>NTCC standards</H4>
        All I/O to and from external files is handled by the driver,
        NCLASS_PT, so there are no calls to	access external files from
        within the NCLASS module.
        <P>
        All variables are declared and identified as either input,
        output, or local in all routines in both NCLASS and NCLASS_PT.
        <P>
        All COMMON blocks have been removed.
        <P>
        Error checking of input has been provided so that array limits
        governed by PARAMETER statements are not exceeded.
        <P>
        Error messages are all passed by a flag from NCLASS to
        the driver routine.
        <P>
        All WRITE formats are isolated in separate routines and
        controlled by a user option 
        <CODE>k_out</CODE> to NCLASS_PT.
        <P>
        Extensive use has been made of variable and routine naming
        conventions (see <A HREF="#Name Conventions">Name Conventions</A>).
        <P>
        Although it is not possibe to adhere to the goal of dynamic
        allocation of variables in FORTRAN 77, NCLASS and NCLASS_PT
        do make use of PARAMETER statements to allocate the storage
        needed for all major arrays.  In NCLASS this is a fairly
        important consideration because of the potentially large arrays
        when multiple charge states of several impurities are of
        interest.  These limits are checked during each calculation
        and error messages are generated if the calculation will
        exceed a limiting parameter.
    <H3><A NAME="NCLASS_PT 1.2">NCLASS_PT 1.2</A></H3>
        This version of NCLASS has been modified in response to suggestions
        by R. Cohen and D. Pearlstein to:
        <UL>
        <LI>Correct a minor error in a friction coefficient
        <LI>Correct an error in the electrical resistivity
        <LI>Allow more extensive testing of the viscosity effects
        </UL>
      <H4>Friction coefficient</H4>
        The field particle friction coefficient N_22,
        <CODE>capn_ii(3,3,i1,i2)</CODE>, was corrected to obey the required
        symmetry constraint for unequal temperatures.  The expression is
        correct in the primary NCLASS reference (see
        <A HREF="#NCLASS equations">NCLASS equations</A>).
      <H4>Electrical resistivity</H4>
        The parallel flow velocity for evaluating the electrical resistivity
        in all earlier versions of NCLASS did not include the field particle
        friction contributions.  This has been corrected by using the u_E,1
        solution, as given by Eqn (37) in the NCLASS reference, instead of
        r_E(1) as incorrectly stated in the paper following Eqn (37).  Eqns
        (38) and (39) of the paper are correct if u_E,1 is used instead of
        r_E(1).
      <H4>Viscosity in various limits</H4>
        The user can now call NCLASS at extreme limits without the code
        failing.  The error flag <CODE>iflag</CODE> is set to a negative
        value to warn the user in case the null or unity input values were
        input by mistake (see <A HREF="#NCLASS output">NCLASS output</A>).
        Such limits include calculations at the	axis (no trapped particles,
        <CODE>p_ft=0</CODE>) or at the edge of a unity aspect ratio
        plasma (no circulating particles, <CODE>p_ft=1.0</CODE>).  The
        banana contributions can be turned off at any radius with
        <CODE>p_ft=0</CODE> to facilitate a calculation with only
        Pfirsch-Schl&uuml;ter contributions to the viscosity.  The
        Pfirsch-Schl&uuml;ter contribution to viscosity can be turned off
        by setting all three poloidal moments of <CODE>p_fm(j)=0.0</CODE>.
        If both <CODE>p_ft=0</CODE> and <CODE>p_fm(j)=0.0</CODE>, the
        Spitzer problem is solved.
  <H2><A NAME="NCLASS Physics">NCLASS Physics</A></H2>
        NCLASS solves the radial and parallel force balance equations
        for the flows within a flux surface using the multiple species,
        reduced charge state approach given in Hirshman and Sigmar's
        1981 review paper.  The radial fluxes in the banana regime are
        related to these flows and the neoclassical viscosities.  The
        bootstrap current and electrical resistivity are also derived
        from these flows.  The classical and Pfirsch-Schl&uuml;ter
        fluxes, as well as the fluxes driven by a user specified
        parallel force are also calculated.
        <P>
        The viscosities are calculated by numerically integrating over
        velocity space and are continuous over all collisionality
        regimes and aspect ratios.  In that regard the model is more
        advanced than the one presented in Hirshman and Sigmar's review
        paper and other codes that use the matrix approach for
        calculating neoclassical properties (e.g., work by Tani, et al.,
        Kessel, Ernst and a few others).  Other advanced features
        include banana orbit squeezing, potato orbit effects and
        additional force terms to accomodate neutral beam, charge
        exchange, toroidal field ripple and anomalous toroidal drag
        forces.  Nonetheless, the model must still be considered only
        an approximation to the physics of transport by drift and orbit
        scattering effects, which are still under development and called
        'advanced neoclassical' theory.  See the reference under
        <A HREF="#NCLASS equations">NCLASS equations</A> for a
        more complete discussion of the model.
    <H3><A NAME="Geometry">Geometry</A></H3>
        NCLASS_PT uses simple geometric approximations to the various
        parameters required by NCLASS.  Modules are available from the
        FORCEBAL code to read VMEC 'wout' files, EFIT 'g' files, EFIT
        results stored in MDS+ at MIT for CMOD, and EFIT results stored
        as PPFs at JET for a more accurate representation of the geometric
        quantities.  Modules are also available to generate the
        required geometric parameters from either VMEC or EFIT
        solutions.  These modules can be modified for any other inverse
        coordinate representation (as VMEC) or poloidal flux grid
        representation (as EFIT).
        <P>
        The signs of the magnetic fields and flows are consistent with
        the right-handed cylindrical coordinate system
        (R,<STRONG>f</STRONG>,Z) where R is measured
        from the major axis and Z is up.  So the toroidal angle
        <STRONG>f</STRONG> runs counter-clockwise when
        viewed from the top of the torus.  The same toroidal angle
        <STRONG>f</STRONG> is used for the right-handed
        (<STRONG>r,q,f</STRONG>) curvilinear
        coordinates so <STRONG>q</STRONG> runs downward
        on the outside midplane.
        <P>
        Most TFTR and DIII-D data have negative toroidal magnetic
        fields and positive toroidal currents and poloidal magnetic
        fields.  The safety factor 'q' should be negative (as in the
        test case) if it is to be consistent with this definition of
        coordinates, but it is usually reported as positive in databases
        by long-standing convention.  JET with its iron core typically
        operates with toroidal field and current in the same direction. 
        NCLASS gives correct signs for the flows and radial electric
        field if the input obeys the above sign conventions.   
    <H3><A NAME="Radial grid">Radial grid</A></H3>
        The radial grid, <STRONG>r</STRONG>, for NCLASS
        can be anything the user desires.  The only requirement is that
        all derivatives consistently use the same definition.  NCLASS_PT
        uses <STRONG>r</STRONG> proportional to the
        square root of the toroidal flux and scaled to the minor radius,
        <CODE>a0</CODE>.  
        <P>
        The grid units are represented as 'rho' inside NCLASS.
        <P>
        To resolve the axial singularity, choose <STRONG>r</STRONG>
        proportional to the poloidal flux, <STRONG>Y</STRONG>.  See the
        discussion under <A HREF="#NCLASS_PT cases">NCLASS_PT cases</A>.
    <H3><A NAME="Particle fluxes">Particle fluxes</A></H3>
        The particle flux is returned in three forms.  The total flux is
        reconstructed in NCLASS_PT as a consistency check on the three
        forms.
        <P>
        The form of the diffusion term in the continuity equation is
        assumed to not contain
        &lt;grad(<STRONG>r</STRONG>)<SUP>2</SUP>&gt; or similar
        geometric factors.  This is because the geometry is built into
        the calculation of the fluxes and transport coefficients through
        the drifts, which are related to the required flux surface
        averaged input quantities.  If the user has
        &lt;grad(<STRONG>r</STRONG>)<SUP>2</SUP>&gt; in the
        transport equations, then the transport coefficients from NCLASS
        must be divided by that same factor.
        <P>
        No diffusivities or convective velocities are presently returned
        for the external force (component 5).  The user can create them
        from the returned flux of species s,
        <CODE>gfl_s(5,s)</CODE>.
        <P>
        The addition of a radial electric field,
        -<STRONG>F</STRONG>', does not affect the
        radial particle or conduction fluxes.  The forces from
        <STRONG>F</STRONG>' are included in NCLASS. 
        Their lack of influence on the poloidal rotation velocities and
        fluxes can be used as a check on the computations.
        A radial electric field gradient does, however, modify the flows
        and fluxes through 'orbit squeezing.'
        <P>
        For the continuity equation,
        <PRE>
          dn<SUB>i</SUB>/dt = 1/V'[V'<STRONG>G</STRONG><SUB>i</SUB>]' + S<SUB>i</SUB>,   i = species,   ' = d/d<STRONG>r</STRONG>
        </PRE>
        the radial fluxes are returned from NCLASS in three different
        forms: 
        <UL>
        <LI>As a flux, <CODE>gfl_s</CODE>, broken into five components:
              1) banana-plateau flux driven by p' and T' forces,
              2) Pfirsch-Schl&uuml;ter flux,
              3) classical flux,
              4) banana-plateau flux driven by the parallel electric
                 field (&lt;E.B&gt;) force, and
              5) banana-plateau flux driven by the external force:
        <PRE>
          <STRONG>G</STRONG><SUB>i</SUB> = <STRONG>S</STRONG><SUB>k</SUB> gfl_s(k,i),   k = 1,5 components
        </PRE>
        <LI>As a diagonal diffusivity, <CODE>dn_s</CODE>, plus three
              contributions to the convective velocity:
              1) <CODE>veb_s</CODE> driven by the &lt;E.B&gt; force
                 (neoclassical pinch),
              2) <CODE>vn_s</CODE> driven by all other off-diagonal
                 p' and T' forces, and
              3) the velocity, calculated externally from the flux
                 <CODE>gfl_s(5,i)</CODE>, driven by the external force,
                 <CODE>fex_iz</CODE>:
        <PRE>
          <STRONG>G</STRONG><SUB>i</SUB>/n<SUB>i</SUB> = - dn_s(i) n<SUB>i</SUB>'/n<SUB>i</SUB> +  vn_s(i) + veb_s(i) + gfl_s(5,i)/n<SUB>i</SUB>
        </PRE>
        <LI>As a complete matrix of coefficients of the temperature
            gradients, <CODE>dt_ss</CODE>, and pressure gradients,
            <CODE>dp_ss</CODE>, plus the &lt;E.B&gt; and external force components:
        <PRE>
          <STRONG>G</STRONG><SUB>i</SUB>/n<SUB>i</SUB> =  <STRONG>S</STRONG><SUB>j</SUB> [- dt_ss(j,i) T<SUB>j</SUB>'/T<SUB>j</SUB> - dp_ss(j,i) p<SUB>j</SUB>'/p<SUB>j</SUB>]
                      + veb_s(i) + gfl_s(5,i)/n<SUB>i</SUB>
        </PRE>
        </UL>
    <H3><A NAME="Conduction fluxes">Conduction fluxes</A></H3>
        The conduction heat flux is returned by NCLASS in two forms (the
        same forms as for the particle flux but without the 'diagonal'
        form).
        <P>
        The same comment about including a geometric factor in the
        particle fluxes also applies to the conduction fluxes.
        <P>
        If all the ions have the the same temperature and the user
        wants to combine the conduction heat fluxes into a single
        effective ion thermal conductivity plus a velocity component (as
        in the second option above for the particle fluxes), that can be
        done externally to NCLASS.  This reconstruction is done in the
        stand-alone driver, NCLASS_PT, and presented as the second form
        below).
        <P>
        The energy balance equation
        <PRE>
        1.5 d(n<SUB>i</SUB>T<SUB>i</SUB>)/dt = 1/V'[V'(Q<SUB>i</SUB> + 2.5 T<SUB>i</SUB><STRONG>G</STRONG><SUB>i</SUB>)]' + ...
        </PRE>
        The three forms of the conduction heat fluxes are:
        <UL>
        <LI>As a flux, <CODE>qfl_s</CODE>, for each species broken
            into the same components as the particle flux:
        <PRE>
          Q<SUB>i</SUB> = <STRONG>S</STRONG><SUB>k</SUB> qfl_s(k,i),  k=1,5 components
        </PRE>
        <LI>As a thermal diffusivity (diagonal component) plus a velocity
            representing the off-diagonal components.  In NCLASS_PT a thermal
            diffusivity for each species is calculated, <CODE>dq_s</CODE>, as
            well as the corresponding convective component, <CODE>vq_s</CODE>. 
            In the equations below, subscript <CODE>a</CODE> represents an
            'average' ion, and is obtained by summing over all ion species. 
            <CODE>Q<SUB>a</SUB></CODE> can be used to evaluate
            <CODE>v<SUB>a</SUB></CODE>, as is done in NCLASS_PT.  Below,
            electrons are assumed to be the first species, although in both
            NCLASS_PT and NCLASS isotopes can be in any order.
        <PRE>
            Q<SUB>e</SUB> = -n<SUB>e</SUB><STRONG>c</STRONG><SUB>e</SUB>T<SUB>e</SUB>' + n<SUB>e</SUB>T<SUB>e</SUB>v<SUB>e</SUB>
                <STRONG>c</STRONG><SUB>e</SUB> = chit_ss(1,1) + chip_ss(1,1)
                v<SUB>e</SUB> = Q<SUB>e</SUB>/n<SUB>e</SUB>T<SUB>e</SUB> + <STRONG>c</STRONG><SUB>e</SUB>T<SUB>e</SUB>'/T<SUB>e</SUB>
            Q<SUB>a</SUB> = -n<SUB>a</SUB><STRONG>c</STRONG><SUB>a</SUB>T<SUB>i</SUB>' + n<SUB>a</SUB>T<SUB>a</SUB>v<SUB>a</SUB>
                <STRONG>c</STRONG><SUB>a</SUB> = <STRONG>S</STRONG><SUB>i </SUB>n<SUB>i</SUB>[chit_ss(i,i) + chip_ss(i,i)]/n<SUB>a</SUB>
                v<SUB>a</SUB> = Q<SUB>a</SUB>/n<SUB>a</SUB>T<SUB>i</SUB> + <STRONG>c</STRONG><SUB>a</SUB>T<SUB>i</SUB>'/T<SUB>i</SUB>
                n<SUB>a</SUB> = <STRONG>S</STRONG><SUB>i</SUB> n<SUB>i</SUB>
            Q<SUB>a</SUB> = <STRONG>S</STRONG><SUB>i</SUB> Q<SUB>i</SUB> 
        </PRE>
        <LI>As a complete matrix of coefficients for each species i driven by
            gradients of each species j:
        <PRE>
            Q<SUB>i</SUB> = n<SUB>i</SUB>T<SUB>i</SUB>{<STRONG>S</STRONG><SUB>j</SUB> [-chit_ss(j,i) T<SUB>j</SUB>'/T<SUB>j</SUB> - chip_ss(j,i) p<SUB>j</SUB>'/p<SUB>j</SUB>]
                          + qeb_s(i) + qfl_s(5,i)/(n<SUB>i</SUB>T<SUB>i</SUB>)}
        </PRE>
        </UL>
    <H3><A NAME="Bootstrap current">Bootstrap current</A></H3>
        The total bootstrap current density is given as the flux surface
        averaged quantity, <CODE>p_bsjb</CODE>. The bootstrap current is also
        returned as a set of coefficients of the pressure and temperature
        gradients of each species, <CODE>bsjbt_s</CODE> and
        <CODE>bsjbp_s</CODE>:
        <PRE>
          &lt;J<SUB>bs</SUB>.B&gt; = p_bsjb
          &lt;J<SUB>bs</SUB>.B&gt; = <STRONG>S</STRONG><SUB>i</SUB> [bsjbt_s(i)T<SUB>i</SUB>'/T<SUB>i</SUB> + bsjbp_s(i)p<SUB>i</SUB>'/p<SUB>i</SUB>]
        </PRE>
    <H3><A NAME="External force current">External force current</A></H3>
        The current response to the external source is returned as the
        flux surface averaged quantity,
        <CODE>p_exjb</CODE>.  An example of
        such a current is the electron response current from neutral
        beam injection, which can be entered through
        <CODE>fex_iz</CODE>.
        <PRE>
          &lt;J<SUB>ex</SUB>.B&gt; = p_exjb
        </PRE>
    <H3><A NAME="Flow velocities">Flow velocities</A></H3>
        Flux surface averaged poloidal and parallel flow velocities are
        output from NCLASS.  The flows at any point in the surface can
        be calculated from these, the local magnetic field components,
        the pressure gradients and the radial electric field.  An
        example of the local flow velocities on the outside midplane
        are given in NCLASS_PT.  It is also possible to modify the
        calculation to obtain the radial electric field if the toroidal
        flow velocity of any ion species is known.  In the FORCEBAL and
        TRANSP implementations of NCLASS this iteration is done
        externally, but could be incorporated in the new NCLASS
        interface routine as an option.
  <H2><A NAME="References">References</A></H2>
    <H3><A NAME="NCLASS equations">NCLASS equations</A></H3>
        <UL>
        <LI>W.A. Houlberg, K.C. Shaing, S.P. Hirshman, M.C. Zarnstorff,
            <i>Phys. Plasmas</i> <B>4</B> (1997) 3230
        </UL>
    <H3><A NAME="Multi-species">Multi-species</A></H3>
        <UL>
        <LI>S.P. Hirshman, D.J. Sigmar,
            <i>Nucl. Fusion</i> <B>21</B> (1981) 1079
        </UL>
    <H3><A NAME="Reduced charge state">Reduced charge state</A></H3>
        <UL>
        <LI>C.D. Boley, E.M. Gelbard, S.P. Hirshman,
            <i>Phys. Fluids</i> <B>22</B> (1979) 1280
        </UL>
    <H3><A NAME="Friction coefficients">Friction coefficients</A></H3>
        <UL>
        <LI>S.P. Hirshman, D.J. Sigmar,
            <i>Phys. Fluids</i> <B>19</B> (1976) 1532
        <LI>S.P. Hirshman,
            <i>Phys. Fluids</i> <B>20</B> (1977) 589
        </UL>
    <H3><A NAME="Viscosity coefficients">Viscosity coefficients</A></H3>
        <UL>
        <LI>K.C. Shaing, C.T. Hsu, M. Yokoyama, M. Wakatani,
            <i>Phys. Plasmas</i> <B>2</B> (1995) 349
        <LI>K.C. Shaing, M. Yokoyama, M. Wakatani, C.T. Hsu,
            <i>Phys. Plasmas</i> <B>3</B> (1996) 965
        </UL>
    <H3><A NAME="Orbit squeezing">Orbit squeezing</A></H3>
        <UL>
        <LI>K.C. Shaing, R.D. Hazeltine,
            <i>Phys. Fluids</i> <B>B 4</B> (1992) 2547
        <LI>K.C. Shaing, C.T. Hsu, R.D. Hazeltine,
            <i>Phys. Plasmas</i> <B>1</B> (1994) 3365
        </UL>
    <H3><A NAME="Trapped fraction">Trapped fraction</A></H3>
        <UL>
        <LI>Y.R. Lin-Liu, R.L. Miller,
            <i>Phys Plasmas</i> <B>2</B> (1995) 1666
        </UL>
    <H3><A NAME="Similar codes">Similar codes</A></H3>
        <UL>
        <LI>K. Tani, M. Azumi, R.S. Devoto,
            <i>J. Comput. Phys.</i> <B>98</B> (1992) 332
        <LI>C.E. Kessel,
            <i>Nucl. Fusion</i> <B>34</B> (1994) 1221
        <LI>D.R. Ernst, et al.,
            <i>Phys. Plasmas</i> <B>5</B> (1998) 665
        <LI>P. Zhu, W. Horton, H. Sugama,
            <i>Phys. Plasmas</i> <B>6</B> (1999) 2503
        </UL>
    <H3><A NAME="Applications">Applications</A></H3>
        <UL>
        <LI>C.E. Bush, et al.,
            <i>J. Nucl. Mater.</i> <B>241-243</B> (1997) 892
        <LI>P.E. Efthimion, et al.,
            <i>Phys. Plasmas</i> <B>5</B> (1998) 1832
        <LI>W.A. Houlberg, L.R. Baylor,
            <i>Fusion Technol.</i> <B>34</B> (1998) 591
        <LI>P.E. Efthimion, et al.,
            1998 Yokoyama IAEA to be published
        <LI>D.L. Hillis, et al.,
            <i>Phys. Plasmas</i> <B>6</B> (1999) 1985
        <LI>M.R. Wade, W.A. Houlberg, L.R. Baylor,
            <i>Phys. Rev. Lett.</i> submitted
        </UL>
  <H2><A NAME="Name Conventions">Name Conventions</A></H2>
      <H4>Routines</H4>
        Extensive use is made of 'module' or 'family' names for routines:
        <UL>
        <LI><CODE>NCLASS_</CODE><i>extension</i> - NCLASS module and driver
        <LI><CODE>RARRAY_</CODE><i>extension</i> - array manipulation routines
        <LI><CODE>WRITE_</CODE><i>extension</i> - output routines
        <LI><CODE>U_</CODE><i>extension</i> - utility routines
        </UL>
      <H4>Variable prefixes</H4>
        Prefixes designate general types of variables:
        <UL>
        <LI><CODE>mx_</CODE><i>extension</i> - dimensioning parameter
        <LI><CODE>c_</CODE><i>extension</i> - constant (profile-independent)
            quantity
        <LI><CODE>k_</CODE><i>extension</i> - option
        <LI><CODE>p_</CODE><i>extension</i> - single point (profile dependent)
            variable
        <LI><CODE>z_</CODE><i>extension</i> - physical or conversion constant
        </UL>
      <H4>Variable suffixes</H3>
        First a clarification of terminology is in order.  An 'isotope'
        may have one or more populated states - e.g., electrons,
        deuterium, carbon are isotopes.  A 'charge state' dependence
        means a variable is doubly dimensioned by parameters for both
        isotopes and charge states; such matrices are sparsely populated.
        A 'species' is a populated charge state.
        <UL>
        <LI><i>descriptor</i><CODE>_iz</CODE> - charge state array
        <LI><i>descriptor</i><CODE>_s</CODE> or
            <i>descriptor</i><CODE>_ss</CODE> - singly or doubly dimensioned
            species array, respectively
        <LI><i>descriptor</i><CODE>_i</CODE> or 
            <i>descriptor</i><CODE>_ii</CODE> - singly or doubly dimensioned
            isotope array, respectively
        </UL>
  <H2><A NAME="NCLASS Variables">NCLASS Variables</A></H2>
    <H3><A NAME="NCLASS input">NCLASS input</A></H3>
      <H4>Options:</H4>
        <PRE>
          k_order-order of v moments to be solved (-)
                 =2 u and q									
                 =3 u, q, and u2
                 =else error
          k_potato-option to include potato orbits (-)
                  =0 off
                  =else on
        </PRE>
      <H4>Numbers limited by dimensioning parameters:</H4>
        <PRE>
          m_i-number of isotopes (1 &lt; m_i &lt; mx_mi+1)
          m_z-highest charge state of all species (0 &lt; m_z &lt; mx_mz+1)
        </PRE>
      <H4>Constants:</H4>
        <PRE>
          c_den-density cutoff below which species is ignored (/m<SUP>3</SUP>)
          c_potb-kappa(0)*Bt(0)/[2*q(0)<SUP>2</SUP>] (T)
          c_potl-q(0)*R(0) (m)
        </PRE>
      <H4>Parameters representing the selected flux surface:</H4>
        <PRE>
          p_b2-&lt;B<SUP>2</SUP>&gt; (T<SUP>2</SUP>)
          p_bm2-&lt;1/B<SUP>2</SUP>&gt; (/T<SUP>2</SUP>)
          p_eb-&lt;E.B&gt; (V*T/m)
          p_fhat-mu_0*F/(dPsi/dr) (rho/m)
          p_fm(3)-poloidal moments of geometric factor for PS viscosity (-)
          p_ft-trapped fraction (-)
          p_grbm2-&lt;grad(rho)<SUP>2</SUP>/B<SUP>2</SUP>&gt; (rho<SUP>2</SUP>/m<SUP>2</SUP>/T<SUP>2</SUP>)
          p_grphi-radial electric field Phi' (V/rho)
          p_gr2phi-radial electric field gradient Psi'(Phi'/Psi')' (V/rho<SUP>2</SUP>)
          p_ngrth-&lt;n.grad(Theta)&gt; (1/m)
        </PRE>
      <H4>Isotope arrays:</H4>
        <PRE>
          amu_i(i)-atomic mass number of i (-)
          grt_i(i)-temperature gradient of i (keV/rho)
          temp_i(i)-temperature of i (keV)
        </PRE>
      <H4>Charge state arrays:</H4>
        <PRE>
          den_iz(i,z)-density of i,z (/m<SUP>3</SUP>)
          fex_iz(3,i,z)-moments of external parallel force on i,z (T*j/m<SUP>3</SUP>)
          grp_iz(i,z)-pressure gradient of i,z (keV/m<SUP>3</SUP>/rho)
        </PRE>
    <H3><A NAME="NCLASS output">NCLASS output</A></H3>
        Any of the output from NCLASS can easily be eliminated by removing
        the arguments from both the calling routine and NCLASS.  This is
        allowed because all the variables are fully declared and dimensioned
        within NCLASS, so that their removal from the argument list converts
        them to local variables.  Although this	feature is not important for
        NCLASS_PT, much of the returned information is either redundant or
        not of interest if NCLASS is to be installed as a module within
        another code.  By the same token, other output could also be easily
        generated as the code evolves. 
      <H4>Error flag:</H4>
        <PRE>
          iflag-warning and error flag
               =-4 warning: no viscosity
               =-3 warning: no banana viscosity
               =-2 warning: no Pfirsch-Schluter viscosity
               =-1 warning: no potato orbit viscosity
               =0 no warnings or errors
               =1 error: order of v moments to be solved must be 2 or 3
               =2 error: number of species must be 1&lt; m_i &lt; mx_mi+1
               =3 error: number of species must be 0 &lt; m_z &lt; mx_mz+1
               =4 error: number of species must be 1 &lt; m_s &lt; mx_ms+1
               =5 error: inversion of flow matrix failed
               =6 error: trapped fraction must be 0.0.le.p_ft.le.1.0
        </PRE>
      <H4>Numbers limited by dimensioning parameters:</H4>
        <PRE>
          m_s-number of species (1 &lt; m_s &lt; mx_ms+1)
        </PRE>
      <H4>Parameters representing the selected flux surface:</H4>
        <PRE>
          p_bsjb-&lt;J_bs.B&gt; (A*T/m<SUP>2</SUP>)
          p_etap-parallel electrical resistivity (Ohm*m)
          p_exjb-&lt;J_ex.B&gt; current response to fex_iz (A*T/m<SUP>2</SUP>)
        </PRE>
      <H4>Isotope arrays:</H4>
        <PRE>
          calm_i(3,3,i)-tp eff friction matrix for i (kg/m<SUP>3</SUP>/s)
          caln_ii(3,3,i1,i2)-fp eff friction matrix for i1 on i2 (kg/m<SUP>3</SUP>/s)
          capm_ii(3,3,i1,i2)-test part (tp) friction matrix for i1 on i2 (-)
          capn_ii(3,3,i1,i2)-field part (fp) friction matrix for i1 on i2 (-)
        </PRE>
      <H4>Species arrays:</H4>
        <PRE>
          bsjbp_s(s)-&lt;J_bs.B&gt; driven by unit p'/p of s (A*T*rho/m<SUP>3</SUP>)
          bsjbt_s(s)-&lt;J_bs.B&gt; driven by unit T'/T of s (A*T*rho/m<SUP>3</SUP>)
          chip_ss(s1,s2)-heat cond coefficient of s2 on p'/p of s1 (rho<SUP>2</SUP>/s)
          chit_ss(s1,s2)-heat cond coefficient of s2 on T'/T of s1 (rho<SUP>2</SUP>/s)
          dn_s(s)-diffusion coefficient (diag comp) of s (rho<SUP>2</SUP>/s)
          dp_ss(s1,s2)-diffusion coefficient of s2 on p'/p of s1 (rho<SUP>2</SUP>/s)
          dt_ss(s1,s2)-diffusion coefficient of s2 on T'/T of s1 (rho<SUP>2</SUP>/s)
          gfl_s(m,s)-radial particle flux comps of s (rho/m<SUP>3</SUP>/s)
                     m=1, banana-plateau, p' and T'
                     m=2, Pfirsch-Schl&uuml;ter
                     m=3, classical
                     m=4, banana-plateau, &lt;E.B&gt;
                     m=5, banana-plateau, external parallel force fex_iz
          jm_s(s)-isotope number of s (-)
          jz_s(s)-charge state of s (-)
          qeb_s(s)-&lt;E.B&gt; heat convection velocity of s (rho/s)
          qfl_s(m,s)-radial heat conduction flux comps of s (W*rho/m<SUP>3</SUP>)
                     m=1, banana-plateau, p' and T'
                     m=2, Pfirsch-Schl&uuml;ter
                     m=3, classical
                     m=4, banana-plateau, &lt;E.B&gt;
                     m=5, banana-plateau, external parallel force fex_iz
          sqz_s(s)-orbit squeezing factor for s (-)
          upar_s(3,m,s)-parallel flow of s from force m (T*m/s)
                        m=1, p' and T'
                        m=2, &lt;E.B&gt;
                        m=3, fex_iz
          utheta_s(3,m,s)-poloidal flow of s from force m (m/s/T)
                          m=1, p', T'
                          m=2, &lt;E.B&gt;
                          m=3, fex_iz
          vn_s(s)-convection velocity (off diag comps-p', T') of s (rho/s)
          veb_s(s)-&lt;E.B&gt; particle convection velocity of s (rho/s)
          xi_s(s)-charge weighted density factor of s (-)
          ymu_s(s)-normalized viscosity for s (kg/m<SUP>3</SUP>/s)
        </PRE>
    <H3><A NAME="NCLASS internal">NCLASS internal</A></H3>
      <H4>Isotope arrays:</H4>
        <PRE>
          amnt_ii(i1,i2)-eff relaxation rate for i1 on i2 (kg/m<SUP>3</SUP>/s)
          vt_i(i)-thermal velocity of i (m/s)
        </PRE>
      <H4>Species arrays:</H4>
        <PRE>
          tau_ss(s1,s2)-90 degree scattering time of s1 on s2 (s)
          ykb_s(s)-banana viscosity for s (kg/m<SUP>3</SUP>/s)
          ykp_s(s)-Pfirsch-Schl&uuml;ter viscosity for s (kg/m<SUP>3</SUP>/s)
          ykpo_s(s)-potato viscosity for s (kg/m<SUP>3</SUP>/s)
          ykpop_s(s)-potato-plateau viscosity for s (kg/m<SUP>3</SUP>/s)
          ynud_s(s)-pitch angle diffusion rate for s (/s)
          ynut_s(s)-anisotropy relaxation rate for s (/s)
          ynuti_s(3,s)-PS anisotropy relaxation rates for s (/s)
        </PRE>
  <H2><A NAME="Driver Variables">Driver Variables</A></H2>
    <H3><A NAME="Driver input">Driver input</A></H3>
      <H4>Options:</H4>
        <PRE>
          k_out-option for output to nout (-)
               =1 errors only
               =2 errors and results 
               =else no output
        </PRE>
      <H4>Parameters representing the selected flux surface:</H4>
        <PRE>
          p_eps-inverse aspect ratio (-)
          p_q-safety factor (-)
        </PRE>
      <H4>Other characteristic machine parameters:</H4>
        <PRE>
          r0-major radius (m)
          a0-minor radius, scale length for rho (m)
          e0-axial elongation (-)
          bt0-axial toroidal field (T)
          q0-axial safety factor (-)
        </PRE>
  <H2><A NAME="Flow Diagram">Flow Diagram</A></H2>
        <PRE>
                                       Parameters          FORTRAN Source

          NCLASS_PT_DR                 mx_mi,mx_ms,mx_mz   NCLASS_PT_DR.FOR
          |							  
          |--NCLASS                                        NCLASS_MOD.FOR
          |  |
          |  |--NCLASS_MN              mx_mi               NCLASS_MOD.FOR
          |  |
          |  |--NCLASS_TAU             mx_mi,mx_ms,mx_mz   NCLASS_MOD.FOR
          |  |  |
          |  |  |--RARRAY_ZERO                             RARRAY_ZERO.FOR
          |  |						   
          |  |--NCLASS_MU              mx_mi,mx_ms,mx_mz   NCLASS_MOD.FOR
          |  |  |
          |  |  |--NCLASS_K            mx_mi,mx_ms         NCLASS_MOD.FOR
          |  |  |  |
          |  |  |  |--NCLASS_NU        mx_mi,mx_ms         NCLASS_MOD.FOR
          |  |  |  |  |
          |  |  |  |  |--U_ERF                             U_ERF.FOR
          |  |  |  |  |
          |  |  |  |  |--RARRAY_ZERO                       RARRAY_ZERO.FOR
          |  |  |  |
          |  |  |  |--RARRAY_ZERO                          RARRAY_ZERO.FOR
          |  |  |
          |  |  |--RARRAY_ZERO                             RARRAY_ZERO.FOR
          |  |
          |  |--NCLASS_FLOW            mx_mi,mx_ms,mx_mz   NCLASS_MOD.FOR
          |     |
          |     |--U_LU_DECOMP                             U_LU_DECOMP.FOR
          |     |
          |     |--U_LU_BACKSUB                            U_LU_BACKSUB.FOR
          |     |
          |     |--RARRAY_ZERO                             RARRAY_ZERO.FOR	 
          |
          |--RARRAY_COPY                                   RARRAY_COPY.FOR
          |					  
          |--RARRAY_SUM                                    RARRAY_SUM.FOR
          |
          |--RARRAY_ZERO                                   RARRAY_ZERO.FOR
          |										 
          |--WRITE_IR                                      WRITE_MOD.FOR
          |
          |--WRITE_LINE                                    WRITE_MOD.FOR
          |
          |--WRITE_LINE_IR                                 WRITE_MOD.FOR
        </PRE>
</BODY>

</HTML>
